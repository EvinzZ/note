# 索引

## 1. 概念

索引是帮助MySQL高效获取数据的数据结构。

## 2. hash算法

哈希表，是根据关键码值而直接进行访问的数据结构。也就是说，它通过把关键码值映射到表中一个位置来访问记录，以加快查找的速度。这个映射函数叫做散列函数，存放记录的数组叫做散列表。

优点：查找可以直接根据key访问

缺点：不能进行范围查找

index = Hash(key)

为什么不支持范围查询？

因为底层数据结构是散列的，无法进行比较大小.

## 3. 平衡二叉树算法

平衡二叉查找树，又称AVL树。它除了具备二叉查找树的基本特征之外，还具备一个非常重要的特点：它的左子树和右子树都是平衡二叉树，且左子树和右子树的深度之差的绝对值（平衡因子）不超过1。也就是说AVL树每个节点的平衡因子之可能是-1、0和1（左子树高度减去右子树高度）。

优点：平衡二叉树算法基本和二叉树查询相同，效率比较高

缺点：插入操作需要旋转，支持范围查询（效率不高）

## 4. B树

在计算机科学中，B树是一种树状数据结构，它能够存储数据、对其进行排序并允许以O的时间复杂度运行进行查找、顺序读取、插入和删除的数据结构。B树，概括来说是一个节点可以拥有多于2个字节点的二叉查找树。与自平衡二叉查找树不通，B-树为系统最优化大块数据的读和写操作。B-tree算法减少定位记录时所经历的中间过程，从而加快存取速度。普遍运用在数据库和文件系统。

因为B树节点元素比平衡二叉树要多，所以B树数据结构相比平衡二叉树数据结构实现减少IO的操作。

## 5. B+树

B+树相比B树，新增叶子节点与非叶子节点关系，叶子节点中包含了key和value，非叶子节点中只是包含了key，不包含value。

所有相邻的叶子节点包含非叶子节点，使用链表进行结合，有一定顺序排序，从而范围查询效率非常高。

![截屏2020-04-09下午6.03.30](../images/%E6%88%AA%E5%B1%8F2020-04-09%E4%B8%8B%E5%8D%886.03.30.png)

## 6.索引失效的情况

1. 在查询条件没有用到索引列。
2. 查询条件中带有or，除非所有的查询条件都建有索引，否则索引失效
3. like查询是以%开头
4. 如果列查询是字符串，那在查询条件中需要将数据用引号引用起来，否则不走索引。
5. 联合索引，查询时的条件列不是联合索引中的第一个列，索引失效。
6. 使用`not in`，`not exist`可能不会走索引。
7. 使用<>,>，<可能不会走索引。
8. 索引列上参与计算会导致索引失效。
9. 在索引列上使用内置函数，索引失效
10. 如果mysql估计全表扫描要比使用索引快，会不使用索引。

## 7.索引分类

### 7.1.主键索引

建立在主键上的索引被称为主键索引，一张数据表只能有一个主键索引，索引列值不允许有空值，通常在创建表时一起创建。

### 7.2.唯一索引

建立在UNIQUE字段上的索引被称为唯一索引，一张表可以有多个唯一索引，索引列值允许为空，列值中出现多个空值不会发生重复冲突。

### 7.3.普通索引

建立在普通字段上的索引被称为普通索引

### 7.4.前缀索引

前缀索引是指对字符类型字段的前几个字符或对二进制类型字段的前几个bytes建立的索引，而不是在整个字段上建索引。前缀索引可以建立在类型为char、varchar、binary、varbinary的列上，可以大大减少索引占用的存储空间，也能提升索引的查询效率。

前缀索引是一种能使索引更小更快的有效方法，但是也包含缺点：mysql无法使用前缀索引做order by和group by

## 8.什么是三星索引？

对于一个查询而言，一个三星索引，可能是其最好的索引。

如果查询使用三星索引，一次查询通常只需要进行一次磁盘随机读以及一次窄索引片的扫描，因此其相应时间通常比使用一个普通索引的响应时间少几个数量级。

一个查询相关的索引行是相邻的或者至少相距足够靠近的则获得一星；

如果索引中的数据顺序和查找中的排列顺序一致则获得二星；

如果索引中的列包含了查询中需要的全部列则获得三星；

三星索引在实际的业务中如果无法同时达到，一般我们认为第三颗星最重要，第一和第二颗星重要性差不多，根据业务情况调整这两颗星的优先度。